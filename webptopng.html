<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor de Imagem WebP para PNG</title>
</head>

<body>
    <h1>Upload de Imagem WebP</h1>
    <div id="dropzone" style="border: 2px dashed #ccc; padding: 20px; text-align: center;">
        Solte a imagem WebP aqui
    </div>
    <p id="file-info"></p>
    <button id="convert-button" style="display: none;">Iniciar Conversão</button>
    <div id="result" style="display: none;">
        <h2>Resultado da Conversão</h2>
        <p>A imagem WebP foi convertida para PNG:</p>
        <img id="png-image" src="" alt="Imagem PNG">
    </div>

    <script>
        const dropzone = document.getElementById('dropzone');
        const fileInfo = document.getElementById('file-info');
        const convertButton = document.getElementById('convert-button');
        const resultDiv = document.getElementById('result');
        const pngImage = document.getElementById('png-image');

        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.style.border = '2px dashed #333'
        })

        dropzone.addEventListener('dragleave', () => {
            dropzone.style.border = '2px dashed #ccc'
        })

        dropzone.addEventListener('drop', async (e) => {
            e.preventDefault()
            dropzone.style.border = '2px dashed #ccc'

            const file = e.dataTransfer.files[0];

            if (file && file.type === 'image/webp') {
                fileInfo.innerHTML = `
                    Nome do arquivo: ${file.name}<br>
                    Tipo do arquivo: ${file.type}<br>
                    Tamanho do arquivo: ${file.size} bytes
                `
                convertButton.style.display = 'block'

                const reader = new FileReader()

                reader.onload = async (e) => {
                    const base64Image = e.target.result.split(',')[1]
                    // Remova a parte "data:image/webp;base64,"

                    convertButton.addEventListener('click', async () => {
                        const URL = 'http://localhost:8888/api/webpToPng/'
                        const response = await fetch(URL, {
                            method: 'POST',
                            body: JSON.stringify({ image: base64Image }),
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })

                        if (response.ok) {
                            const responseData = await response.json() // Processar a resposta como JSON
                            const pngImageBase64 = responseData.pngImageBase64
                            resultDiv.style.display = 'block'
                            pngImage.src = 'data:image/png;base64,' + pngImageBase64
                        } else {
                            console.error('Erro na conversão:', response.statusText)
                        }
                    })
                }

                reader.readAsDataURL(file);
            } else {
                fileInfo.textContent = 'Por favor, selecione um arquivo WebP válido.'
            }
        })
    </script>
</body>

</html>